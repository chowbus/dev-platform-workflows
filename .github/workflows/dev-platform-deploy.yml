name: Deploy via dev-platform

# Wrapper workflow for dev-platform-workflows 自测
# 调用本仓库的 web-deploy-template.yml 进行测试

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Deployment environment'
        required: true
        type: choice
        options:
          - staging-02
          - staging-04
          - staging-06
        default: 'staging-02'
      bucket_name:
        description: 'S3 bucket name'
        required: true
        type: string
        default: 'dev-platform-workflows-test'
      callback_url:
        description: 'Deployment callback URL'
        required: false
        type: string
      cloudfront_id:
        description: 'CloudFront Distribution ID'
        required: false
        type: string
      git_ref:
        description: 'Git branch/tag to deploy'
        required: false
        type: string
        default: 'main'
      iteration_id:
        description: 'Iteration ID'
        required: false
        type: string
      iteration_name:
        description: 'Iteration name'
        required: false
        type: string
      version:
        description: 'Version number'
        required: false
        type: string
        default: '1.0.0'

jobs:
  deploy:
    uses: chowbus/dev-platform-workflows/.github/workflows/web-deploy-template.yml@main
    with:
      environment: ${{ inputs.environment }}
      bucket_name: ${{ inputs.bucket_name }}
      callback_url: ${{ inputs.callback_url }}
      cloudfront_id: ${{ inputs.cloudfront_id }}
      git_ref: ${{ inputs.git_ref }}
      iteration_id: ${{ inputs.iteration_id }}
      iteration_name: ${{ inputs.iteration_name }}
      version: ${{ inputs.version }}
      node_version: '18'
      build_command: 'build_${{ inputs.environment }}'
      build_output_dir: 'build'
    secrets:
      AWS_ACCESS_KEY_ID_STAGING_CI: ${{ secrets.AWS_ACCESS_KEY_ID_STAGING_CI }}
      AWS_SECRET_ACCESS_KEY_STAGING_CI: ${{ secrets.AWS_SECRET_ACCESS_KEY_STAGING_CI }}
      AWS_ACCESS_KEY_ID_PRODUCTION_CI: ${{ secrets.AWS_ACCESS_KEY_ID_PRODUCTION_CI }}
      AWS_SECRET_ACCESS_KEY_PRODUCTION_CI: ${{ secrets.AWS_SECRET_ACCESS_KEY_PRODUCTION_CI }}
      AWS_REGION: ${{ secrets.AWS_REGION }}
